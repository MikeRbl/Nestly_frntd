<!-- Contenedor principal con padding y fondo -->
<div class="p-6 md:p-8 bg-gray-50 dark:bg-gray-900 min-h-screen">
  
  <!-- Encabezado de la página -->
  <header class="mb-8">
    <h1 class="text-3xl font-bold text-gray-800 dark:text-white">Gestión de Solicitudes de Rol</h1>
    <p class="text-gray-500 dark:text-gray-400 mt-1">
      Revisa y procesa las solicitudes de los usuarios que quieren convertirse en propietarios.
    </p>
  </header>

  <!-- Contenedor de la tabla con sombra y bordes redondeados -->
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
    
    <!-- Skeleton Loader: Se muestra mientras los datos cargan -->
    <div *ngIf="isLoading" class="animate-pulse">
      <div *ngFor="let i of [1,2,3,4,5]" class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
        <div class="flex items-center gap-4">
          <div class="w-10 h-10 bg-gray-300 dark:bg-gray-600 rounded-full"></div>
          <div class="space-y-2">
            <div class="h-4 bg-gray-300 dark:bg-gray-600 rounded w-32"></div>
            <div class="h-3 bg-gray-200 dark:bg-gray-700 rounded w-48"></div>
          </div>
        </div>
        <div class="h-8 bg-gray-300 dark:bg-gray-600 rounded-md w-24"></div>
      </div>
    </div>

    <!-- Mensaje cuando no hay solicitudes -->
    <div *ngIf="!isLoading && solicitudes.length === 0" class="text-center p-12">
      <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <h3 class="mt-2 text-lg font-medium text-gray-900 dark:text-white">Todo al día</h3>
      <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">No hay solicitudes pendientes por revisar.</p>
    </div>

    <!-- Tabla de solicitudes -->
    <div *ngIf="!isLoading && solicitudes.length > 0" class="overflow-x-auto">
      <table class="min-w-full">
        <thead class="bg-gray-50 dark:bg-gray-700">
          <tr>
            <!-- Columna extra para el botón de expandir -->
            <th scope="col" class="w-12"></th> 
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Usuario</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Fecha Solicitud</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Estado</th>
            <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Acciones</th>
          </tr>
        </thead>
        <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">

          <ng-container *ngFor="let solicitud of solicitudes">
            <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
              <!-- Botón para expandir/colapsar los detalles -->
              <td class="pl-4">
                <button (click)="solicitud.expanded = !solicitud.expanded" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600 transition-transform" [class.rotate-90]="solicitud.expanded">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                  </svg>
                </button>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex items-center">
                  <div class="flex-shrink-0 h-10 w-10">
                    <div class="h-10 w-10 rounded-full overflow-hidden flex items-center justify-center bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-300 font-bold">
                      <ng-container *ngIf="solicitud.user?.avatar_url; else iniciales">
                        <img 
                          [src]="solicitud.user.avatar_url" 
                          [alt]="solicitud.user.full_name || solicitud.user.first_name"
                          class="h-full w-full object-cover"
                        />
                      </ng-container>
                      <ng-template #iniciales>
                        {{ solicitud.user?.first_name?.charAt(0) }}{{ solicitud.user?.last_name_paternal?.charAt(0) }}
                      </ng-template>
                    </div>
                  </div>
                  <div class="ml-4">
                    <div class="text-sm font-medium text-gray-900 dark:text-white">{{ solicitud.user?.first_name }} {{ solicitud.user?.last_name_paternal }}</div>
                    <div class="text-sm text-gray-500 dark:text-gray-400">{{ solicitud.user?.email }}</div>
                  </div>
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                {{ solicitud.created_at | date:'dd/MM/yyyy h:mm a' }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                      [ngClass]="getStatusClass(solicitud.status)">
                  {{ solicitud.status | titlecase }}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                <div *ngIf="solicitud.status === 'pendiente'" class="flex items-center justify-end gap-2">
                  <button (click)="procesarSolicitud(solicitud.id, 'aprobado')" 
                          class="text-green-600 hover:text-green-900 dark:text-green-400 dark:hover:text-green-200 transition-colors px-3 py-1 rounded-md bg-green-100 dark:bg-green-800/50 hover:bg-green-200 dark:hover:bg-green-700/50">
                    Aprobar
                  </button>
                  <button (click)="procesarSolicitud(solicitud.id, 'rechazado')" 
                          class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-200 transition-colors px-3 py-1 rounded-md bg-red-100 dark:bg-red-800/50 hover:bg-red-200 dark:hover:bg-red-700/50">
                    Rechazar
                  </button>
                </div>
                <span *ngIf="solicitud.status !== 'pendiente'" class="text-gray-400 dark:text-gray-500 italic">Procesada</span>
              </td>
            </tr>
            <!-- Fila de Detalles  -->
            <tr *ngIf="solicitud.expanded" class="bg-gray-50 dark:bg-gray-700/50">
              <td colspan="5" class="p-4">

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                  <div class="p-3 bg-white dark:bg-gray-800 rounded-lg">
                    <p class="font-semibold text-gray-700 dark:text-gray-200">Miembro Desde</p>
                    <p class="text-gray-500 dark:text-gray-400">{{ solicitud.user?.created_at | date:'dd/MM/yyyy' }}</p>
                  </div>
                  <div class="p-3 bg-white dark:bg-gray-800 rounded-lg">
                    <p class="font-semibold text-gray-700 dark:text-gray-200">Rentas Completadas</p>
                    <p class="text-gray-500 dark:text-gray-400">{{ solicitud.user?.completed_rents || 0 }}</p>
                  </div>
                  <div class="p-3 bg-white dark:bg-gray-800 rounded-lg">
                    <p class="font-semibold text-gray-700 dark:text-gray-200">Perfil Completo</p>
                    <span class="px-2 py-1 text-xs rounded-full" [ngClass]="solicitud.user?.profile_complete ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'">
                      {{ solicitud.user?.profile_complete ? 'Sí' : 'No' }}
                    </span>
                  </div>
                </div>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </table>
    </div>
  </div>
</div>

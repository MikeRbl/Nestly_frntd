<div class="space-y-8">
  <!-- Encabezado -->
  <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
    <h3 class="text-2xl md:text-3xl font-bold text-gray-800 dark:text-white">Gestión de Usuarios</h3>
  </div>
<div *ngIf="isLoading" class="flex flex-col items-center justify-center h-full text-center">
  <img src="https://media.tenor.com/-I-6w9klVyEAAAAm/utya-telegram.webp" alt="Cargando..." class="w-20 h-20" />
</div>
  <!-- Panel de Contenido Principal -->
  <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg overflow-hidden">
    <!-- Barra de Búsqueda y Filtros -->
    <div class="p-6 border-b border-gray-200 dark:border-gray-700">
      <div class="flex flex-col sm:flex-row items-center gap-4">
        <div class="relative w-full sm:w-1/2 lg:w-1/3">
          <input
            type="text"
            placeholder="Buscar por nombre o email..."
            [(ngModel)]="filtros.search"
            (input)="applyFilters()"
            class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:text-white dark:border-gray-600"
          />
          <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
            <svg class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
          </div>
        </div>

        <select [(ngModel)]="filtros.role" (change)="applyFilters()" class="w-full sm:w-auto pl-3 pr-10 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:text-white dark:border-gray-600">
          <option value="">Todos los roles</option>
          <option value="admin">Admin</option>
          <option value="propietario">Propietario</option>
          <option value="inquilino">Inquilino</option>
        </select>
      </div>
    </div>

    <!-- Tabla de Usuarios -->
<div class="overflow-x-auto rounded-2xl border border-gray-200 dark:border-gray-700 shadow-md">      <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
        <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
          <tr>
            <th scope="col" class="px-6 py-3">Usuario</th>
            <th scope="col" class="px-6 py-3">Rol</th>
            <th scope="col" class="px-6 py-3">Fecha de Registro</th>
            <th scope="col" class="px-6 py-3">Estado</th>
            <th scope="col" class="px-6 py-3 text-right">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <!-- Estado de Carga (Skeleton) -->
          <tr *ngIf="isLoading">
            <td colspan="5" class="p-0">
              <div class="p-6 space-y-4 animate-pulse">
                <div *ngFor="let _ of [1,2,3]" class="flex items-center space-x-4">
                  <div class="w-10 h-10 bg-gray-200 dark:bg-gray-700 rounded-full"></div>
                  <div class="flex-1 space-y-2">
                    <div class="h-3 bg-gray-200 dark:bg-gray-700 rounded w-3/4"></div>
                    <div class="h-2 bg-gray-200 dark:bg-gray-700 rounded w-1/2"></div>
                  </div>
                </div>
              </div>
            </td>
          </tr>

          <!-- Contenedor para mostrar solo cuando NO está cargando -->
          <ng-container *ngIf="!isLoading">
            <!-- Mensaje de "No se encontraron usuarios" -->
            <tr *ngIf="users.length === 0">
              <td colspan="5" class="px-6 py-16 text-center">
                <p class="text-gray-500 dark:text-gray-400">No se encontraron usuarios con los filtros actuales.</p>
              </td>
            </tr>

            <!-- Filas de Datos Reales -->
            <tr *ngFor="let user of users" class="bg-white dark:bg-gray-800 border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
              <td class="px-6 py-4">
                <div class="flex items-center gap-3">
                  <img class="w-10 h-10 rounded-full object-cover" [src]="user.avatar_url || 'assets/default-profile.png'" alt="Avatar">
                  <div>
                    <div class="font-semibold text-gray-900 dark:text-white">{{ user.first_name }} {{ user.last_name_paternal }}</div>
                    <div class="text-xs text-gray-500 dark:text-gray-400">{{ user.email }}</div>
                  </div>
                </div>
              </td>
              <td class="px-6 py-4">
                <span class="role-badge" [ngClass]="{
                  'role-admin': user.role === 'admin',
                  'role-propietario': user.role === 'propietario',
                  'role-inquilino': user.role === 'inquilino'
                }">{{ user.role | titlecase }}</span>
              </td>
              <td class="px-6 py-4">{{ user.created_at | date:'dd MMM, yyyy' }}</td>
              <td class="px-6 py-4">
  <div class="relative w-full">
  <select
    [value]="user.status"
    (change)="cambiarEstadoUsuario(user, $event)"
    (click)="toggleSelect(user.id)"
    (blur)="cerrarSelect(user.id)"
    [ngClass]="{
      'bg-green-500 text-white dark:bg-green-600 dark:text-white': user.status === 'activo',
      'bg-red-500 text-white dark:bg-red-600 dark:text-white': user.status === 'baneado'
    }"
    class="appearance-none block w-full px-3 py-2 border border-transparent rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out cursor-pointer font-medium pr-10"
  >
    <option class="text-black bg-white" value="activo">Activo</option>
    <option class="text-black bg-white" value="baneado">Baneado</option>
  </select>

  <!-- SVG dinámico individual por usuario -->
  <div class="pointer-events-none absolute inset-y-0 right-2 flex items-center">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
      stroke-width="1.5"
      stroke="currentColor"
      class="size-5 text-white dark:text-white transform transition-transform duration-300"
      [ngClass]="{
        'rotate-180': selectAbierto[user.id],
        'rotate-0': !selectAbierto[user.id]
      }"
    >
      <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
    </svg>
  </div>
</div>



              </td>
              <td class="px-6 py-4 text-right">
                <div class="flex items-center justify-end gap-2">
                  <button (click)="editarUsuario(user.id)" class="action-btn text-blue-500 hover:bg-blue-100 dark:hover:bg-blue-500/10" aria-label="Editar"><svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z" /></svg></button>
                  <button (click)="eliminarUsuario(user.id, user.first_name)" class="action-btn text-red-500 hover:bg-red-100 dark:hover:bg-red-500/10" aria-label="Eliminar"><svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg></button>
                </div>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </table>
    </div>

    <!-- Paginador Reutilizable -->
      <div *ngIf="!isLoading" class="mt-8 px-6">
        <app-admin-paginador
          [length]="totalItems"
          [pageSize]="pageSize"
          [pageIndex]="pageIndex"
          (pageChange)="onPageChange($event)"
        ></app-admin-paginador>

      </div>

  </div>
</div>

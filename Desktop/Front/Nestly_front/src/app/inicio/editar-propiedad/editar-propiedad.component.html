

<div *ngIf="isLoading && !formulario.dirty" class="flex flex-col items-center justify-center py-20">
  <img
    src="https://i.pinimg.com/originals/2d/16/75/2d16752412daa809899e7711aa44dadb.gif"
    alt="Cargando..."
    class="w-24 h-24 object-contain"
  />
  <p class="mt-4 text-gray-500 dark:text-gray-400 text-center">
    Cargando datos de la propiedad...
  </p>
</div>


<form *ngIf="!isLoading || formulario.dirty" [formGroup]="formulario" (ngSubmit)="actualizarPropiedad()" novalidate>
  <!-- Encabezado -->
  <div class="flex items-center justify-between mb-8">
    <h3 class="text-2xl md:text-3xl font-bold text-gray-800 dark:text-white">Editar Propiedad</h3>
    <div class="flex gap-3">
       <button type="button" (click)="cancelarEdicion()" [disabled]="isLoading" class="px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 font-semibold rounded-lg transition">Cancelar</button>
      <button type="submit" [disabled]="isLoading" class="px-10 py-3 bg-blue-500 text-white font-semibold rounded-lg shadow-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75 transition">
        <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
        {{ isLoading ? 'Actualizando...' : 'Actualizar' }}
      </button>
    </div>
  </div>

  <!-- Contenedor principal del formulario en tres columnas -->
  <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">

    <!-- Columna 1 -->
    <div class="space-y-6">
      <div class="p-6 dark:bg-gray-800/20 rounded-xl h-full">
        <h3 class="form-section-title">Información Principal</h3>
        <div>
          <label for="titulo" class="form-label">Título de la Propiedad</label>
          <input type="text" id="titulo" formControlName="titulo" class="form-control">
        </div>
        <div class="mt-4">
          <label for="descripcion" class="form-label">Descripción</label>
          <textarea id="descripcion" formControlName="descripcion" class="form-control" rows="10"></textarea>
        </div>

        <div class="col-span-2">

          <h3 class="form-section-title">Información de Contacto</h3>
          <label for="email" class="form-label">Correo Electrónico</label>
          <input type="email" id="email" formControlName="email" class="form-control">
        </div>


      </div>
    </div>

    <!-- Columna 2 -->
<div class="space-y-6">
  <div class="p-6 dark:bg-gray-800/20 rounded-xl">
    <h3 class="form-section-title">Características</h3>
    <div class="grid grid-cols-2 gap-4">
      <div>
        <label for="precio" class="form-label">Precio (MXN)</label>
        <input type="number" id="precio" formControlName="precio" class="form-control" min="0" step="any" />
      </div>
      <div>
        <label for="habitaciones" class="form-label">Habitaciones</label>
        <input type="number" id="habitaciones" formControlName="habitaciones" class="form-control" min="1" />
      </div>
      <div>
        <label for="banos" class="form-label">Baños</label>
        <input type="number" id="banos" formControlName="banos" class="form-control" min="1" />
      </div>
      <div>
        <label for="metros_cuadrados" class="form-label">Metros Cuadrados</label>
        <input type="number" id="metros_cuadrados" formControlName="metros_cuadrados" class="form-control" min="0" step="any" />
      </div>
      <div class="col-span-2">
        <label for="tipo_propiedad_id" class="form-label">Tipo de Propiedad</label>
        <select id="tipo_propiedad_id" formControlName="tipo_propiedad_id" class="form-control">
          <option value="" disabled>Selecciona</option>
          <option *ngFor="let tipo of tiposDePropiedad" [value]="tipo.id">{{ tipo.nombre }}</option>
        </select>
      </div>
      <div class="col-span-2">
        <label for="estado_propiedad" class="form-label">Estado de la Propiedad</label>
        <select id="estado_propiedad" formControlName="estado_propiedad" class="form-control">
          <option value="Disponible">Disponible</option>
          <option value="Rentada">Rentada</option>
          <option value="Inactiva">Inactiva</option>
        </select>
      </div>
    </div>
  </div>

  <div class="p-6 dark:bg-gray-800/20 rounded-xl">
    <h3 class="form-section-title">Opciones Adicionales</h3>
    <div class="grid grid-cols-1 gap-y-4">
      <div class="flex items-center justify-between">
        <label class="form-label !mb-0">Amueblado</label>
        <div class="toggle-switch w-28">
          <button type="button" (click)="f['amueblado'].setValue(true)" [class.active]="f['amueblado'].value === true">Sí</button>
          <button type="button" (click)="f['amueblado'].setValue(false)" [class.active]="f['amueblado'].value === false">No</button>
        </div>
      </div>
      <div class="flex items-center justify-between">
        <label class="form-label !mb-0">Mascotas</label>
        <div class="toggle-switch w-28">
          <button type="button" (click)="f['mascotas'].setValue('si')" [class.active]="f['mascotas'].value === 'si'">Sí</button>
          <button type="button" (click)="f['mascotas'].setValue('no')" [class.active]="f['mascotas'].value === 'no'">No</button>
        </div>
      </div>
      <div class="flex items-center justify-between">
        <label class="form-label !mb-0">Contrato Anual</label>
        <div class="toggle-switch w-28">
          <button type="button" (click)="f['anualizado'].setValue(true)" [class.active]="f['anualizado'].value === true">Sí</button>
          <button type="button" (click)="f['anualizado'].setValue(false)" [class.active]="f['anualizado'].value === false">No</button>
        </div>
      </div>
    </div>
  </div>
</div>

    
    <!-- Columna 3 -->
    <div class="space-y-6">
      <div class="p-6 dark:bg-gray-800/20 rounded-xl">
        <h3 class="form-section-title">Ubicación y Contacto</h3>
        <div class="grid grid-cols-2 gap-4">
          <div><label for="pais" class="form-label">País</label><input type="text" id="pais" formControlName="pais" class="form-control"></div>
          <div><label for="estado_ubicacion" class="form-label">Estado</label><input type="text" id="estado_ubicacion" formControlName="estado_ubicacion" class="form-control"></div>
          <div><label for="ciudad" class="form-label">Ciudad</label><input type="text" id="ciudad" formControlName="ciudad" class="form-control"></div>
          <div><label for="colonia" class="form-label">Colonia</label><input type="text" id="colonia" formControlName="colonia" class="form-control"></div>
          <div class="col-span-2"><label for="direccion" class="form-label">Dirección Completa</label><input type="text" id="direccion" formControlName="direccion" class="form-control"></div>
          <div class="col-span-2"><label for="telefono" class="form-label">Teléfono</label><input type="text" id="telefono" formControlName="telefono" class="form-control" maxlength="10"></div>
        </div>
      </div>
      <div class="p-6 dark:bg-gray-800/20 rounded-xl">
        <h3 class="form-section-title">Fotos de la Propiedad</h3>
        <input type="file" (change)="onFileChange($event)" multiple accept="image/*" class="form-control">
        <div class="mt-4 grid grid-cols-3 sm:grid-cols-4 gap-4">
          <div *ngFor="let foto of existingImages; let i = index" class="relative">
            <img [src]="foto.url" alt="imagen" class="w-full h-24 object-cover rounded-md">
            <button type="button" (click)="removeExistingImage(i)" class="absolute top-0 right-0 -mt-2 -mr-2 bg-red-500 text-white rounded-full h-6 w-6 flex items-center justify-center text-xs shadow">&times;</button>
          </div>
          <div *ngFor="let foto of newImagePreviews; let i = index" class="relative">
            <img [src]="foto" alt="preview" class="w-full h-24 object-cover rounded-md">
            <button type="button" (click)="removeNewImage(i)" class="absolute top-0 right-0 -mt-2 -mr-2 bg-red-500 text-white rounded-full h-6 w-6 flex items-center justify-center text-xs shadow">&times;</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</form>

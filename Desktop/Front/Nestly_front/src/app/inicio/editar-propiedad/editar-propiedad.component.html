<div class="max-w-6xl mx-auto p-6">
  <h2 class="text-2xl font-semibold text-gray-800 mb-6 text-center">Editar Propiedad</h2>

  <div *ngIf="isLoading && !formulario.dirty" class="flex flex-col items-center justify-center py-10">
    <div class="animate-spin rounded-full h-12 w-12 border-t-4 border-blue-500"></div>
    <p class="mt-4 text-gray-500">Cargando datos de la propiedad...</p>
  </div>

  <form *ngIf="!isLoading || formulario.dirty" [formGroup]="formulario" (ngSubmit)="actualizarPropiedad()" novalidate class="grid grid-cols-1 md:grid-cols-2 gap-6">
    
    <!-- Columna Izquierda -->
    <div class="space-y-6">
      <!-- Información Principal -->
      <div>
        <h3 class="text-lg font-medium text-gray-700">Información Principal</h3>
        <div class="mt-4 space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-600">Título de la Publicación *</label>
            <input type="text" class="w-full border border-gray-300 rounded px-3 py-2 text-sm" formControlName="titulo" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-600">Descripción *</label>
            <textarea rows="4" class="w-full border border-gray-300 rounded px-3 py-2 text-sm" formControlName="descripcion"></textarea>
          </div>
        </div>
      </div>

      <!-- Ubicación -->
      <div>
        <h3 class="text-lg font-medium text-gray-700">Ubicación</h3>
        <div class="mt-4 space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-600">Dirección Completa *</label>
            <input type="text" class="w-full border border-gray-300 rounded px-3 py-2 text-sm" formControlName="direccion" />
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-600">País *</label>
              <input type="text" class="w-full border border-gray-300 rounded px-3 py-2 text-sm" formControlName="pais" />
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-600">Estado *</label>
              <input type="text" class="w-full border border-gray-300 rounded px-3 py-2 text-sm" formControlName="estado_ubicacion" />
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-600">Ciudad *</label>
              <input type="text" class="w-full border border-gray-300 rounded px-3 py-2 text-sm" formControlName="ciudad" />
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-600">Colonia</label>
              <input type="text" class="w-full border border-gray-300 rounded px-3 py-2 text-sm" formControlName="colonia" />
            </div>
          </div>
        </div>
      </div>

      <!-- Contacto -->
      <div>
        <h3 class="text-lg font-medium text-gray-700">Información de Contacto</h3>
        <div class="mt-4 grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-600">Correo electrónico *</label>
            <input type="email" class="w-full border border-gray-300 rounded px-3 py-2 text-sm" formControlName="email" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-600">Teléfono *</label>
            <input type="text" class="w-full border border-gray-300 rounded px-3 py-2 text-sm" formControlName="telefono" />
          </div>
        </div>
      </div>
    </div>

    <!-- Columna Derecha -->
    <div class="space-y-6">
      <!-- Características -->
      <div>
        <h3 class="text-lg font-medium text-gray-700">Características y Detalles</h3>

        <div *ngIf="tiposDePropiedad.length === 0" class="text-sm text-gray-500">Cargando tipos de propiedad...</div>

        <div *ngIf="tiposDePropiedad.length > 0" class="mt-4 grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-600">Tipo de Propiedad *</label>
            <select class="w-full border border-gray-300 rounded px-3 py-2 text-sm" formControlName="tipo_propiedad_id">
              <option value="" disabled>Selecciona una opción</option>
              <option *ngFor="let tipo of tiposDePropiedad" [value]="tipo.id">{{ tipo.nombre }}</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-600">Estado de la Propiedad *</label>
            <select class="w-full border border-gray-300 rounded px-3 py-2 text-sm" formControlName="estado_propiedad">
              <option value="" disabled>Selecciona un estado</option>
              <option value="Disponible">Disponible</option>
              <option value="Rentada">Rentada</option>
              <option value="Inactiva">Inactiva</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-600">Precio (MXN) *</label>
            <input type="number" class="w-full border border-gray-300 rounded px-3 py-2 text-sm" formControlName="precio" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-600">Habitaciones *</label>
            <input type="number" class="w-full border border-gray-300 rounded px-3 py-2 text-sm" formControlName="habitaciones" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-600">Baños *</label>
            <input type="number" class="w-full border border-gray-300 rounded px-3 py-2 text-sm" formControlName="banos" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-600">Metros Cuadrados *</label>
            <input type="number" class="w-full border border-gray-300 rounded px-3 py-2 text-sm" formControlName="metros_cuadrados" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-600">Depósito</label>
            <input type="number" class="w-full border border-gray-300 rounded px-3 py-2 text-sm" formControlName="deposito" />
          </div>
        </div>
      </div>

      <!-- Opciones -->
      <div class="grid grid-cols-3 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-600 mb-1">¿Amueblado?</label>
          <div class="flex space-x-2">
            <button type="button" class="px-3 py-1 rounded border text-sm" [class.bg-green-500]="f['amueblado'].value === true" (click)="f['amueblado'].setValue(true)">Sí</button>
            <button type="button" class="px-3 py-1 rounded border text-sm" [class.bg-red-500]="f['amueblado'].value === false" (click)="f['amueblado'].setValue(false)">No</button>
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-600 mb-1">¿Renta anual?</label>
          <div class="flex space-x-2">
            <button type="button" class="px-3 py-1 rounded border text-sm" [class.bg-green-500]="f['anualizado'].value === true" (click)="f['anualizado'].setValue(true)">Sí</button>
            <button type="button" class="px-3 py-1 rounded border text-sm" [class.bg-red-500]="f['anualizado'].value === false" (click)="f['anualizado'].setValue(false)">No</button>
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-600 mb-1">¿Mascotas?</label>
          <div class="flex space-x-2">
            <button type="button" class="px-3 py-1 rounded border text-sm" [class.bg-green-500]="f['mascotas'].value === 'si'" (click)="f['mascotas'].setValue('si')">Sí</button>
            <button type="button" class="px-3 py-1 rounded border text-sm" [class.bg-red-500]="f['mascotas'].value === 'no'" (click)="f['mascotas'].setValue('no')">No</button>
          </div>
        </div>
      </div>

      <!-- Fotos -->
      <div>
        <h3 class="text-lg font-medium text-gray-700 mt-4">Fotos de la Propiedad</h3>
        <input type="file" (change)="onFileChange($event)" multiple accept="image/*" class="w-full mt-2 text-sm" />

        <!-- Imágenes actuales -->
        <div class="mt-4 grid grid-cols-3 gap-2">
          <div *ngFor="let foto of existingImages; let i = index" class="relative">
            <img [src]="foto.url" alt="imagen" class="w-full h-24 object-cover rounded" />
            <button type="button" (click)="removeExistingImage(i)" class="absolute top-1 right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">&times;</button>
          </div>
        </div>

        <!-- Previews nuevas -->
        <div class="mt-4 grid grid-cols-3 gap-2">
          <div *ngFor="let foto of newImagePreviews; let i = index" class="relative">
            <img [src]="foto" alt="preview" class="w-full h-24 object-cover rounded" />
            <button type="button" (click)="removeNewImage(i)" class="absolute top-1 right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">&times;</button>
          </div>
        </div>
      </div>

      <!-- Botones -->
      <div class="flex justify-end space-x-3 mt-6">
        <button type="button" (click)="cancelarEdicion()" [disabled]="isLoading" class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition">Cancelar</button>
        <button type="submit" [disabled]="isLoading" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition">
          <span *ngIf="isLoading" class="loader mr-2"></span>
          {{ isLoading ? 'Actualizando...' : 'Actualizar Propiedad' }}
        </button>
      </div>
    </div>
  </form>
</div>

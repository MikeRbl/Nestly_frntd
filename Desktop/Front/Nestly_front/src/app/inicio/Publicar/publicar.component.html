<div class="container py-4">
  <h2 class="mb-4">Publicar una Nueva Propiedad</h2>
  
  <form [formGroup]="formulario" (ngSubmit)="publicarPropiedad()" novalidate>
    <div class="row">

      <div class="col-lg-6">
        
        <h5>Información Principal</h5>
        <hr class="mt-2 mb-3">
        <div class="mb-2">
          <label class="form-label">Título de la Publicación *</label>
          <input type="text" class="form-control form-control-sm" formControlName="titulo"
            [ngClass]="{ 'is-invalid': f['titulo'].invalid && (f['titulo'].touched || formSubmitted) }" />
        </div>
        <div class="mb-3">
          <label class="form-label">Descripción *</label>
          <textarea class="form-control form-control-sm" rows="4" formControlName="descripcion"
            [ngClass]="{ 'is-invalid': f['descripcion'].invalid && (f['descripcion'].touched || formSubmitted) }"></textarea>
        </div>

        <h5>Ubicación</h5>
        <hr class="mt-2 mb-3">
        <div id="map"></div> 
        <small class="text-muted mb-3 d-block">Haz clic en el mapa para seleccionar la ubicación de la propiedad. También puedes arrastrar el marcador.</small>
        <div class="mb-2">
          <label class="form-label">Dirección Completa *</label>
          <input type="text" class="form-control form-control-sm" formControlName="direccion"
            [ngClass]="{ 'is-invalid': f['direccion'].invalid && (f['direccion'].touched || formSubmitted) }" />
        </div>
        <div class="row">
          <div class="col-md-6 mb-2">
            <label class="form-label">País *</label>
            <input type="text" class="form-control form-control-sm" formControlName="pais"
              [ngClass]="{ 'is-invalid': f['pais'].invalid && (f['pais'].touched || formSubmitted) }" />
          </div>
          <div class="col-md-6 mb-2">
            <label class="form-label">Estado *</label>
            <input type="text" class="form-control form-control-sm" formControlName="estado_ubicacion"
              [ngClass]="{ 'is-invalid': f['estado_ubicacion'].invalid && (f['estado_ubicacion'].touched || formSubmitted) }" />
          </div>
          <div class="col-md-6 mb-2">
            <label class="form-label">Ciudad *</label>
            <input type="text" class="form-control form-control-sm" formControlName="ciudad"
              [ngClass]="{ 'is-invalid': f['ciudad'].invalid && (f['ciudad'].touched || formSubmitted) }" />
          </div>
          <div class="col-md-6 mb-2">
            <label class="form-label">Colonia</label>
            <input type="text" class="form-control form-control-sm" formControlName="colonia" />
          </div>
        </div>

        <h5 class="mt-3">Información de Contacto</h5>
        <hr class="mt-2 mb-3">
        <div class="row">
          <div class="col-md-6 mb-2">
            <label class="form-label">Correo electrónico *</label>
            <input type="email" class="form-control form-control-sm" formControlName="email"
              [ngClass]="{ 'is-invalid': f['email'].invalid && (f['email'].touched || formSubmitted) }" />
          </div>
          <div class="col-md-6 mb-2">
            <label class="form-label">Teléfono *</label>
            <input type="text" class="form-control form-control-sm" formControlName="telefono"
              [ngClass]="{ 'is-invalid': f['telefono'].invalid && (f['telefono'].touched || formSubmitted) }" />
          </div>
        </div>
      </div>

      <div class="col-lg-6">

        <h5>Características y Detalles</h5>
        <hr class="mt-2 mb-3">
        <div class="row">
          <div class="col-md-6 mb-2">
              <label class="form-label">Tipo de Propiedad *</label>
              <select class="form-select form-select-sm" formControlName="tipo_propiedad_id" 
                [ngClass]="{ 'is-invalid': f['tipo_propiedad_id'].invalid && (f['tipo_propiedad_id'].touched || formSubmitted) }">
                <option value="" disabled selected>Selecciona una opción</option>
                <option *ngFor="let tipo of tiposDePropiedad" [value]="tipo.id">{{ tipo.nombre }}</option>
              </select>
          </div>
          <div class="col-md-6 mb-2">
            <label class="form-label">Precio (MXN) *</label>
            <input type="number" class="form-control form-control-sm" formControlName="precio"
              [ngClass]="{ 'is-invalid': f['precio'].invalid && (f['precio'].touched || formSubmitted) }" />
          </div>
          <div class="col-md-6 mb-2">
            <label class="form-label">Habitaciones *</label>
            <input type="number" class="form-control form-control-sm" formControlName="habitaciones"
              [ngClass]="{ 'is-invalid': f['habitaciones'].invalid && (f['habitaciones'].touched || formSubmitted) }" />
          </div>
          <div class="col-md-6 mb-2">
            <label class="form-label">Baños *</label>
            <input type="number" class="form-control form-control-sm" formControlName="banos"
              [ngClass]="{ 'is-invalid': f['banos'].invalid && (f['banos'].touched || formSubmitted) }" />
          </div>
          <div class="col-md-6 mb-2">
            <label class="form-label">Metros Cuadrados *</label>
            <input type="number" class="form-control form-control-sm" formControlName="metros_cuadrados"
              [ngClass]="{ 'is-invalid': f['metros_cuadrados'].invalid && (f['metros_cuadrados'].touched || formSubmitted) }" />
          </div>
          <div class="col-md-6 mb-2">
            <label class="form-label">Depósito</label>
            <input type="number" class="form-control form-control-sm" formControlName="deposito" />
          </div>
        </div>

        <div class="row mt-2">
          <div class="col-md-4 mb-3">
              <label class="form-label d-block">¿Amueblado? *</label>
              <div class="btn-group btn-group-sm" role="group">
                <button type="button" class="btn" [ngClass]="f['amueblado'].value ? 'btn-success' : 'btn-outline-secondary'" (click)="f['amueblado'].setValue(true)">Sí</button>
                <button type="button" class="btn" [ngClass]="!f['amueblado'].value ? 'btn-danger' : 'btn-outline-secondary'" (click)="f['amueblado'].setValue(false)">No</button>
              </div>
          </div>
          <div class="col-md-4 mb-3">
              <label class="form-label d-block">¿Renta anual? *</label>
              <div class="btn-group btn-group-sm" role="group">
                <button type="button" class="btn" [ngClass]="f['anualizado'].value ? 'btn-success' : 'btn-outline-secondary'" (click)="f['anualizado'].setValue(true)">Sí</button>
                <button type="button" class="btn" [ngClass]="!f['anualizado'].value ? 'btn-danger' : 'btn-outline-secondary'" (click)="f['anualizado'].setValue(false)">No</button>
              </div>
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label d-block">¿Mascotas? *</label>
            <div class="btn-group btn-group-sm" role="group">
              <button type="button" class="btn" [ngClass]="f['mascotas'].value === 'si' ? 'btn-success' : 'btn-outline-secondary'" (click)="f['mascotas'].setValue('si')">Sí</button>
              <button type="button" class="btn" [ngClass]="f['mascotas'].value === 'no' ? 'btn-danger' : 'btn-outline-secondary'" (click)="f['mascotas'].setValue('no')">No</button>
            </div>
          </div>
        </div>

        <h5 class="mt-2">Fotos de la Propiedad</h5>
        <hr class="mt-2 mb-3">
        <div class="mb-3">
          <label class="form-label">Cargar Imágenes *</label>
          <input type="file" class="form-control form-control-sm" (change)="onFileChange($event)" multiple accept="image/*" />
          <div class="text-danger small mt-1" *ngIf="fotosInvalid">Debes subir al menos una foto.</div>
          <div class="row mt-2 g-2">
            <div class="col-4" *ngFor="let foto of previewUrls; let i = index">
              <div class="position-relative">
                <img [src]="foto" class="img-fluid rounded border" style="height: 80px; width: 100%; object-fit: cover;" />
                <button type="button" class="btn btn-sm btn-danger rounded-circle position-absolute top-0 end-0 m-1 lh-1" (click)="removePhoto(i)">
                  &times;
                </button>
              </div>
            </div>
          </div>
        </div>
          <div class="d-grid gap-2 d-md-flex justify-content-md-end">
          <button type="submit" class="btn btn-primary px-4" [disabled]="isLoading">
            <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
            {{ isLoading ? 'Publicando...' : 'Publicar Propiedad' }}
          </button>
        </div>
      </div>
      
    </div>

    
    
  </form>
</div>